{"posts":[{"title":"【Stata】 2SLS工具变量法操作","text":"稳健性之工具变量 1 基本要求工具变量需满足的两个前提假设： 相关性：IV与X相关，理论上的正负关系应与回归中的正负方向相同 外生性（排他性）：IV与模型的误差项不相关，即IV与其他影响Y的因素无关（IV不会直接影响Y，只会通过影响X进而影响Y） 2 操作代码12345678910111213//用ivreg检验工具变量是否满足基本要求ivreghdfe Y $control (X = IV) , a( stkcd year ) cluster ( stkcd ) firstdisplay e(cdf)display e(widstat)//手动进行两阶段回归reghdfe X IV $control ,a( stkcd year ) cluster (stkcd)predict IV_reghdfe Y IV_ $control ,a( stkcd year ) cluster (stkcd) 3 关注结果必看 Weak identification test （弱工具变量检验）：IV与内生解释变量的相关性是否够强 Cragg-Donald Wald F statistic的值大于10% maximal的水平 当仅有一个IV时看（IV个数少于内生变量个数） Underidentification test （不可识别检验）：IV的个数是否少于内生解释变量的个数 Kleibergen-Paap rk LM statistic的值大于10，且P值小于0.1 拒绝“工具变量识别不足”的原假设 当有多个IV时看 overidentification test（过度识别检验）：评估多余的IV是否与模型的扰动项无关 Hansen J statistic 的P值大于0.1 接受原假设“所有额外的工具变量都是外生的” 回归结果 第一阶段显著 第二阶段显著，系数最好不要大于基准回归的10倍 作话：关注结果处省略了不常用的检验统计量，傻瓜式学习之先分清X和Y…","link":"/2024/06/01/2-2SLS%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95%E6%93%8D%E4%BD%9C/"},{"title":"【Stata】 一周一北核 DDL远离我 —— 数据篇","text":"数据基本功 数据结果是一篇实证论文的支撑条件，本文将详细梳理实证论文中必不可少的回归步骤，以实现提速增效，当然，前提是对逻辑、代码、数据已做好准备工作。 1 基准回归 描述性统计 皮尔森相关性分析（可选） 1pwcorr_a Y X $control 基准回归 1reghdfe Y X , a( stkcd year ) vce( cluster stkcd ) 2 稳健性分析 工具变量⭐ 更换变量定义 改变样本 增加宏观控制变量 剔除特殊事件影响 剔除直辖市（北京、天津、重庆、上海） 增加固定效应 Oster检验 PSM检验 Heckman检验（需要增加外生变量） 平行趋势检验（基准为DID） 安慰剂检验（基准为DID） Bacon分解（多期DID） X滞后一期 改变模型 3 机制分析后面的做不出来可以调整，基准和机制必须首先完成 中介❌ 争议太多了，不要选 直接回归 中文期刊不考虑此方法，X→M用回归做，M→Y用论文证明 1reghdfe M X $control , a( stkcd year ) vce( cluster stkcd ) 分组 为和异质性区别，尽量不用全样本分组，考虑事前一年、期初，并在此基础上考虑分年份、行业 1reghdfe Y X $control , a( stkcd year ) vce( cluster stkcd ) , if M == 1 系数差异检验 1、似无相关检验 下载第三方的ado文件并替换原文件，此命令支持xtreg固定效应和聚类标准误https://gitee.com/arlionn/suest_panel/ 12345678910xtreg Y X $control i.year if M==1 ,feest store highxtreg Y X $control i.year if M==0 ,feest store lowesttab high low , nogap mtitle(high_coll low_coll) star(* 0.1 ** 0.05 *** 0.01) s(r2 N)suest high low , cluster(stkcd)test [high_mean]X = [low_mean]X//汇报系数差异P值，Prob &gt; chi2的值小于0.1则表明两组存在显著差异 2、邹检验 本质上是交乘，分组变量与X、Controls、固定效应交乘 123//M被omitted了不用管reghdfe Y c.M##c.(X $control ) , a( stkcd#M year#M ) cluster(stkcd)//关注c.M#c.X的结果，汇报系数差异P值，小于0.1则表明两组存在显著差异 3、费舍尔组合检验⭐ 支持reghdfe和聚类，记得设置随机种子，reps代表抽样次数，一般用500或1000，次数越多越精准 1bdiff, group( M ) model(reghdfe Y X $control ,a(stkcd year) cluster (stkcd)) reps(1000) bdec(4) pdec(4) bsample seed(123456) 交乘 先将M按中位数或其他方式分成0和1两组 离散变量前都要加 i. 前缀，连续变量则需加 c. 前缀，对于取值为0/1的虚拟变量可以省略前缀 仅看交乘项是否显著 1组系数=交乘项系数+X单独项系数，0组系数=X单独项系数，若X单独项不显著则认为系数是0 将两组系数与基准回归系数相比较，优先看哪组系数方向相同，若均相同则绝对值较大的一组影响更大 1reghdfe Y c.X##c.M $controls , a( stkcd year ) vce( cluster stkcd ) 4 异质性分析在尝试常用变量后，用选题中特有的相关变量进行结果补充 注意：机制和异质性的方法不要混用，交乘与分组二选一 微观层面要求4个及以上 产权性质 融资约束 信息不对称 企业规模 企业年龄 分析师关注度 媒体关注度 内部控制 高管特征 政治关联 资本密集度、劳动密集度 宏观层面要求2个及以上 行业集中度 政府干预 政府补贴 市场化程度 中东西部 是否重污染行业 是否高科技行业 沿海城市（GDP发达城市） 5 经济后果 TFP TBQ ROA ROE 经营困境 融资约束 EVA 营业收入增长率 技术创新 股价崩盘 换Y Y’指前滞（F.）一期或多期的经济后果变量，当期不是最优选 1reghdfe Y' X , a( stkcd year ) vce( cluster stkcd ) 交乘 仅关注交乘项结果，直接判断显著性和正负方向，X和Y的其中之一需要01变量分组 1reghdfe Y' c.X##c.Y , a( stkcd year ) vce( cluster stkcd ) 差分 Kim, Y., Su, L. (Nancy), Wang, Z., and Wu, H. 2021. The Effect of Trade Secrets Law on Stock Price Synchronicity: Evidence from the Inevitable Disclosure Doctrine.The Accounting Review , 96(1), pp. 325–348. 样本量减少是正常的 12345678910//生成所有变量的差分项，包括X、Y和控制变量//D.是t期与t-1期的差值xtset stkcd yeargen DX = D.X//一阶段回归并生成拟合值reghdfe DY DX $Dcontrols , a( stkcd year ) vce( cluster stkcd )predict R//生成t+1期经济后果变量的差分并回归gen DZ = F.D.Zreghdfe DZ R $Dcontrols , a( stkcd year ) vce( cluster stkcd ) 第二阶段回归结果表明，X对Y的影响，显著增加（减少）了Z 作话：梳理实证步骤，对基础知识查漏补缺，整理这个帖子的时候学到一些没做过的东西…","link":"/2024/06/01/3-%E4%B8%80%E5%91%A8%E4%B8%80%E5%8C%97%E6%A0%B8DDL%E8%BF%9C%E7%A6%BB%E6%88%91%EF%BC%88%E4%B8%8A%EF%BC%89/"},{"title":"【Stata】 Oster检验结果排版及描述","text":"稳健性之遗漏变量检验 1 基本原理 通过设定可达到的最大 $R^2 (Rmax)$ 和未观测变量的相对重要性 ($\\delta $)来估计遗漏变量可能造成的影响，并判断处理效应估计值的稳定性。 根据Oster (2019)的建议，我们假设$Rmax$是基准回归模型中$R^2$的1.3倍，而未观测变量对因变量的影响至少与已观测变量同等重要，即$\\delta = 1$，进一步采用估计量$\\beta^\\star =\\beta^\\star (Rmax, \\delta )$得到真实系数的一致估计。 2 操作代码12345678910//计算Uncontrolled结果reghdfe Y X, noa vce(cl ind3#year) level(99.5)//计算Controled结果与置信区间reghdfe Y X $controls ,a( ind3#year ) vce(cl ind3#year) level(99.5)//计算true beta与beta为0时的deltalocal r = e(r2) * 1.3psacalc2 beta X, delta(1) rmax(`r')psacalc2 delta X, beta(0) rmax(`r') 3 结果排版 Dependent variable Y Uncontrolled coefficients -0.0130 Uncontrolled R² 0.001 Controled coefficients 0.0073*** Controled R² 0.405 99.5% Confidence interval [-0.0005,0.0152] Control variables YES Industry-Year fixed effect YES “True” $\\beta$ 0.0192 $\\delta$ for $\\beta$ = 0 -0.8627 按顺序需要手动录入以下数据： Uncontrolled下的X回归系数与R-squared 12345678910111213141516171819. reghdfe Y X, noa vce(cl ind3#year) level(99.5)(MWFE estimator converged in 1 iterations)HDFE Linear regression Number of obs = 16,752Absorbing 1 HDFE group F( 1, 847) = 2.47Statistics robust to heteroskedasticity Prob &gt; F = 0.1167 R-squared = 0.0013 Adj R-squared = 0.0012 Within R-sq. = 0.0013Number of clusters (ind3#year) = 848 Root MSE = 6.2419 (Std. err. adjusted for 848 clusters in ind3#year)------------------------------------------------------------------------------ | Robust Y | Coefficient std. err. t P&gt;|t| [99.5% conf. interval]-------------+---------------------------------------------------------------- X | -.0130469 .0083091 -1.57 0.117 -.0364321 .0103383 _cons | 8.291464 .2427002 34.16 0.000 7.608406 8.974521------------------------------------------------------------------------------ Controled下的X回归系数、R-squared与置信区间 12345678910111213141516171819202122232425262728293031. reghdfe Y X $controls ,a( ind3#year ) vce(cl ind3#year) level(99.5)(MWFE estimator converged in 1 iterations)HDFE Linear regression Number of obs = 16,752Absorbing 1 HDFE group F( 13, 847) = 46.08Statistics robust to heteroskedasticity Prob &gt; F = 0.0000 R-squared = 0.4049 Adj R-squared = 0.3727 Within R-sq. = 0.0814Number of clusters (ind3#year) = 848 Root MSE = 4.9466 (Std. err. adjusted for 848 clusters in ind3#year)------------------------------------------------------------------------------ | Robust Y | Coefficient std. err. t P&gt;|t| [99.5% conf. interval]-------------+---------------------------------------------------------------- X | .0073397 .0027781 2.64 0.008 -.000479 .0151585 Lev | -.1551993 .2676344 -0.58 0.562 -.9084319 .5980334 firmage | -.0206417 .1378441 -0.15 0.881 -.4085913 .3673078 Size | 1.397631 .061951 22.56 0.000 1.223276 1.571987 sfee | 1.895896 .5163247 3.67 0.000 .4427476 3.349045 Dual | .1007562 .0789137 1.28 0.202 -.1213394 .3228517 Top1 | -.012556 .0028019 -4.48 0.000 -.0204416 -.0046704 Indep | -.0170681 .0075772 -2.25 0.025 -.0383933 .0042572 occupy | -2.832035 2.223062 -1.27 0.203 -9.08864 3.42457 Cash | 1.180776 .4373728 2.70 0.007 -.0501698 2.411722 Soe | -1.301147 .1252125 -10.39 0.000 -1.653546 -.9487476 Gdp | .6944393 .1217796 5.70 0.000 .3517018 1.037177 People | -.635223 .1217548 -5.22 0.000 -.9778907 -.2925554 _cons | -3.086463 .9588209 -3.22 0.001 -5.784976 -.387949------------------------------------------------------------------------------ Estimate出的true Beta 123456789101112131415161718192021222324 psacalc2 beta X, delta(1) rmax(`r') ---- Treatment Effect Estimate ---- | Estimate Sq. difference Bias changes | from controlled beta direction-------------+----------------------------------------------------------------Beta | 0.01920 .000141 Alt. sol. 1 | -2.18561 4.81 YesAlt. sol. 2 | -------------+---------------------------------------------------------------- ---- Inputs from Regressions ---- | Coeff. R-Squared-------------+----------------------------------------------------------------Uncontrolled | -0.01305 0.001Controlled | 0.00734 0.405-------------+---------------------------------------------------------------- ---- Other Inputs -----------------+----------------------------------------------------------------R_max | 0.526Delta | 1.000Unr. Controls| -------------+---------------------------------------------------------------- Estimate出的delta 1234567891011121314151617181920 psacalc2 delta X, beta(0) rmax(`r') ---- Bound Estimate -----------------+----------------------------------------------------------------delta | -0.86273-------------+---------------------------------------------------------------- ---- Inputs from Regressions ---- | Coeff. R-Squared-------------+----------------------------------------------------------------Uncontrolled | -0.01305 0.001Controlled | 0.00734 0.405-------------+---------------------------------------------------------------- ---- Other Inputs -----------------+----------------------------------------------------------------R_max | 0.526Beta | 0.000000Unr. Controls| -------------+---------------------------------------------------------------- 4 结果判断与描述oster有多种判断方法，满足其一就可以： true $\\beta$ 与基准回归系数相比，绝对值更大，且符号相同 表明X对Y的真实影响可能大于基准模型中的回归系数，且不会出现符号相反的情况 $\\delta$ 大于1或小于0 大于1表明：不可观测变量的重要性需要是可观测变量的 $\\delta$ 倍时，才会产生零处理效果，这种情况较难成立，验证了系数的稳定性 小于0表明：经偏差调整后的估计系数应大于基准回归中得到的系数 true $\\beta$ 落在置信区间内 true $\\beta$ 与Controled coefficients（基准回归中X的系数）形成的区间落在置信区间内 说明并不存在与本文解释变量同等重要的遗漏变量影响本文结论 true $\\beta$ 与Controled coefficients（基准回归中X的系数）构成的区间不包含0 说明遗漏变量不太可能将处理效应的真实值推至0 作话：mark住下次不要再忘了…","link":"/2024/05/20/1-Oster%E6%A3%80%E9%AA%8C%E7%BB%93%E6%9E%9C%E6%8E%92%E7%89%88%E5%8F%8A%E6%8F%8F%E8%BF%B0/"}],"tags":[{"name":"Stata","slug":"Stata","link":"/tags/Stata/"},{"name":"写作","slug":"写作","link":"/tags/%E5%86%99%E4%BD%9C/"}],"categories":[{"name":"备忘录","slug":"备忘录","link":"/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"}],"pages":[{"title":"","text":"欢迎来到LXX的学术日记 👋经管类在读硕士研究生 💻没有什么是Stata搞不定的 🔍公司金融 | 企业战略 | 绿色发展 🚀数据分析 | 论文写作 | 工作日志 | 一切有意思的新发现 🎨阅读 | 音乐 | 运动 🎯短期目标：顺利毕业 | 攻读博士学位 🌟 长期愿景：发 Top | 成为一个积极且优秀的人 感谢阅读 期待您的留言 助力学术小白每一次进步🎉","link":"/about.html"}]}